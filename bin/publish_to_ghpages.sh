
#!/bin/sh

RED='\033[0;31m'
GREEN='\033[0;32m'
CYAN='\033[0;36m'
NC='\033[0m' # No Color

if [ "`git status -s`" ]
then
    echo -e "${RED}The working directory is dirty. Please commit any pending changes.${NC}"
    exit 1;
fi

echo -e "${GREEN}Deleting old publication${NC}"
rm -rf public
mkdir public
git worktree prune
rm -rf .git/worktrees/public/

echo -e "${GREEN}Checking out gh-pages branch into public${NC}"
git worktree add -B gh-pages public origin/gh-pages

echo -e "${GREEN}Removing existing files${NC}"
rm -rf public/*

echo -e "${GREEN}Generating site${NC}"
hugo

echo -e "${GREEN}Updating gh-pages branch${NC}"
cd public && \
echo "Generated by Hugo. Latest built at $(date)." > README && \
git add . && \
git commit -m "Publishing to gh-pages (publish.sh)"

echo -e "${GREEN}Pushing to github${NC}"
git push

echo -e "${GREEN}Done!${NC}"
